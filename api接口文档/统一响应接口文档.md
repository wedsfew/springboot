# 统一响应接口文档

## 一、概述

本文档描述了系统统一的API响应格式和测试接口。所有API接口都遵循相同的响应结构，确保前后端交互的一致性和可预测性。

## 二、统一响应格式

### 2.1 响应结构

```json
{
  "code": 200,           // 业务状态码
  "message": "操作成功",   // 响应描述信息
  "data": { ... },       // 响应数据（可能为null）
  "timestamp": "2025-08-10T23:40:49.123456"  // 服务器响应时间戳（ISO 8601格式）
}
```

### 2.2 状态码定义

| 状态码 | 含义       | 适用场景                     | 前端处理建议                                |
| ------ | ---------- | ---------------------------- | ------------------------------------------- |
| 200    | 成功       | 请求处理完成且结果正常       | 解析 data 展示业务数据                      |
| 201    | 创建成功   | 资源（如用户、订单）创建完成 | 可跳转至详情页或提示创建结果                |
| 400    | 请求错误   | 参数格式错误、缺失必填项等   | 展示具体参数错误信息（如`data.errors`）     |
| 401    | 未授权     | 未登录、token 过期或无效     | 跳转至登录页                                |
| 403    | 禁止访问   | 登录状态下无操作权限         | 提示 "无权限"，可跳转至首页                 |
| 404    | 资源不存在 | 请求的 URL 或资源 ID 不存在  | 提示 "资源不存在"                           |
| 409    | 资源冲突   | 资源已存在（如用户名重复）   | 提示冲突原因（如 "用户名已被注册"）         |
| 500    | 服务器错误 | 后端逻辑异常、数据库错误等   | 提示 "系统繁忙，请稍后重试"，不展示技术细节 |

## 三、测试接口

以下是用于测试统一响应格式的API接口：

### 3.1 成功响应测试

#### 简单成功响应

- **请求方式**：GET
- **请求路径**：`/api/test/success`
- **响应示例**：
  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": "这是一个成功的响应",
    "timestamp": "2025-08-10T23:40:49.123456"
  }
  ```

#### 带数据的成功响应

- **请求方式**：GET
- **请求路径**：`/api/test/data`
- **响应示例**：
  ```json
  {
    "code": 200,
    "message": "获取数据成功",
    "data": {
      "name": "测试用户",
      "age": 25,
      "email": "test@example.com"
    },
    "timestamp": "2025-08-10T23:40:49.123456"
  }
  ```

#### 列表数据响应

- **请求方式**：GET
- **请求路径**：`/api/test/list`
- **响应示例**：
  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": ["项目1", "项目2", "项目3"],
    "timestamp": "2025-08-10T23:40:49.123456"
  }
  ```

### 3.2 创建资源响应测试

- **请求方式**：POST
- **请求路径**：`/api/test/create`
- **响应示例**：
  ```json
  {
    "code": 201,
    "message": "创建成功",
    "data": {
      "id": 100,
      "username": "newUser",
      "password": "password123",
      "email": "new@example.com"
    },
    "timestamp": "2025-08-10T23:40:49.123456"
  }
  ```

### 3.3 错误响应测试

#### 业务错误

- **请求方式**：GET
- **请求路径**：`/api/test/business-error`
- **响应示例**：
  ```json
  {
    "code": 400,
    "message": "业务处理失败：参数不符合业务规则",
    "data": null,
    "timestamp": "2025-08-10T23:40:49.123456"
  }
  ```

#### 资源未找到

- **请求方式**：GET
- **请求路径**：`/api/test/not-found/{id}`
- **响应示例**：
  ```json
  {
    "code": 404,
    "message": "ID为123的资源不存在",
    "data": null,
    "timestamp": "2025-08-10T23:40:49.123456"
  }
  ```

#### 服务器错误

- **请求方式**：GET
- **请求路径**：`/api/test/server-error`
- **响应示例**：
  ```json
  {
    "code": 500,
    "message": "服务器内部错误",
    "data": "服务器内部错误测试",
    "timestamp": "2025-08-10T23:40:49.123456"
  }
  ```

## 四、使用说明

### 4.1 前端使用建议

1. 所有API请求应首先检查响应中的`code`字段，判断请求是否成功
2. 当`code`为200或201时，从`data`字段获取业务数据
3. 当`code`不为200或201时，显示`message`字段内容作为错误提示
4. 对于表单验证错误（code=400），可以从`data.errors`中获取具体的字段错误信息

### 4.2 后端实现说明

统一响应格式通过以下组件实现：

1. `ApiResponse<T>` - 统一响应结构类
2. `GlobalExceptionHandler` - 全局异常处理器
3. `BusinessException` - 业务异常类
4. `ResourceNotFoundException` - 资源未找到异常类

开发新接口时，应使用`ApiResponse`类的静态方法返回标准格式的响应：

```java
// 成功响应
return ApiResponse.success(data);
return ApiResponse.success("自定义成功消息", data);

// 创建成功响应
return ApiResponse.created(newResource);

// 错误响应
throw new BusinessException(400, "业务错误消息");
throw new ResourceNotFoundException("资源名称");
```

## 五、测试方法

可以使用以下命令测试API接口：

```bash
# 测试成功响应
curl http://localhost:8083/api/test/success

# 测试带数据的成功响应
curl http://localhost:8083/api/test/data

# 测试创建资源响应
curl -X POST http://localhost:8083/api/test/create

# 测试业务错误
curl http://localhost:8083/api/test/business-error

# 测试资源未找到
curl http://localhost:8083/api/test/not-found/123

# 测试服务器错误
curl http://localhost:8083/api/test/server-error