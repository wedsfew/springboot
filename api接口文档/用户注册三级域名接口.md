# 用户注册三级域名接口文档

## 接口概述

本接口用于用户注册三级域名（如xxx.cblog.eu），并自动添加A记录指向指定IP地址，同时将用户邮箱作为备注信息。

## 接口信息

- **接口标识**：`USER_REGISTER_SUBDOMAIN`
- **请求路径**：`POST /api/user/domains/register`
- **接口描述**：用户注册三级域名并添加A记录
- **认证要求**：需要JWT认证
- **适用业务单元**：用户域名管理

## 请求参数

### JSON请求体格式

```json
{
  "subDomain": "test",         // 必填，三级域名前缀
  "domain": "cblog.eu",        // 可选，主域名，默认为"cblog.eu"
  "value": "8.8.8.8",          // 必填，IP地址
  "ttl": 600                   // 可选，TTL值，默认为600
}
```

## 请求示例

```bash
curl -X POST "http://localhost:8080/api/user/domains/register" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "subDomain": "test",
    "value": "8.8.8.8"
  }'
```

## 响应格式

### 成功响应（状态码 200）

```json
{
  "code": 200,
  "message": "域名 test.cblog.eu 注册成功",
  "data": {
    "skipSign": false,
    "requestId": "ab4f1426-ea15-42ea-8183-dc1b44151166",
    "recordId": 162
  },
  "timestamp": "2025-08-22T02:30:00Z"
}
```

### 失败响应

#### 参数错误（400）

```json
{
  "code": 400,
  "message": "子域名前缀不能为空",
  "data": null,
  "timestamp": "2025-08-22T02:30:00Z"
}
```

#### 未授权（401）

```json
{
  "code": 401,
  "message": "未授权：需要有效的JWT令牌",
  "data": null,
  "timestamp": "2025-08-22T02:30:00Z"
}
```

#### 域名已被注册（409）

```json
{
  "code": 409,
  "message": "域名 test.cblog.eu 已被注册",
  "data": null,
  "timestamp": "2025-08-22T02:30:00Z"
}
```

#### 服务器错误（500）

```json
{
  "code": 500,
  "message": "注册三级域名失败: 调用腾讯云DNSPod创建记录API失败",
  "data": null,
  "timestamp": "2025-08-22T02:30:00Z"
}
```

## 业务流程说明

1. **身份验证**：从JWT token中获取用户邮箱
2. **参数验证**：验证子域名前缀和IP地址是否有效
3. **域名可用性检查**：检查三级域名是否已被注册
4. **创建DNS记录**：如果域名可用，添加A记录，并将用户邮箱作为备注
5. **返回结果**：返回注册结果，包括记录ID等信息

## 注意事项

1. **权限要求**：用户必须登录并持有有效的JWT令牌
2. **邮箱备注**：系统会自动将用户的邮箱作为DNS记录的备注信息
3. **域名唯一性**：同一个三级域名只能被一个用户注册
4. **默认设置**：
   - 默认主域名为"cblog.eu"
   - 默认TTL值为600秒
   - 默认记录类型为A记录
   - 默认记录线路为"默认"
   - 默认记录状态为"ENABLE"

## 测试用例

### 测试用例1：成功注册三级域名

**请求参数**：
```json
{
  "subDomain": "mytest",
  "value": "8.8.8.8"
}
```

**预期响应**：
- code=200
- message包含"注册成功"
- data包含recordId

### 测试用例2：注册已存在的三级域名

**请求参数**：
```json
{
  "subDomain": "www",
  "value": "8.8.8.8"
}
```

**预期响应**：
- code=409
- message包含"已被注册"

### 测试用例3：参数缺失

**请求参数**：
```json
{
  "subDomain": ""
}
```

**预期响应**：
- code=400
- message包含"子域名前缀不能为空"

## 相关接口

- [DNSPod添加记录接口](/api接口文档/DNSPod添加记录接口.md)
- [DNSPod查询可用三级域名接口](/api接口文档/DNSPod查询可用三级域名接口.md)
- [获取域名后缀接口](/api接口文档/域名后缀接口文档.md)