# 域名同步功能接口文档

## 接口概述

域名同步功能提供了从DNSPod获取域名列表并同步到本地数据库的完整API接口。支持域名信息的查询、管理和同步操作。

## 基础信息

- **Base URL**: `http://localhost:8080/api/domains`
- **Content-Type**: `application/json`
- **字符编码**: `UTF-8`
- **认证方式**: 无需认证（已在WebSecurityConfig中开放）

## 接口列表

### 1. 域名同步接口

#### 基本信息
- **接口标识**: `DOMAIN_SYNC`
- **请求路径**: `POST /api/domains/sync`
- **接口描述**: 从DNSPod获取域名列表并同步到本地数据库
- **认证要求**: 无需认证

#### 请求参数
无需请求参数

#### 响应示例

##### 成功响应（状态码 200）
```json
{
  "code": 200,
  "message": "操作成功",
  "data": "成功同步 3 个域名",
  "timestamp": "2025-08-21T08:30:00"
}
```

##### 失败响应（状态码 500）
```json
{
  "code": 500,
  "message": "同步域名列表失败: DNSPod API调用失败",
  "data": null,
  "timestamp": "2025-08-21T08:30:00"
}
```

#### 测试用例
```bash
# 测试域名同步
curl -X POST "http://localhost:8080/api/domains/sync" \
  -H "Content-Type: application/json"
```

### 2. 获取所有域名接口

#### 基本信息
- **接口标识**: `DOMAIN_LIST`
- **请求路径**: `GET /api/domains`
- **接口描述**: 获取本地数据库中所有域名信息
- **认证要求**: 无需认证

#### 响应示例

##### 成功响应（状态码 200）
```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "id": 1,
      "domainId": 123456,
      "name": "example.com",
      "punycode": "example.com",
      "grade": "DP_Free",
      "gradeLevel": 1,
      "gradeTitle": "免费套餐",
      "isVip": "NO",
      "owner": "user@example.com",
      "status": "ENABLE",
      "groupId": 1,
      "searchEnginePush": "NO",
      "recordCount": 5,
      "ttl": 600,
      "cnameSpeedup": "DISABLE",
      "dnsStatus": "DNSPOD",
      "remark": "测试域名",
      "vipStartAt": null,
      "vipEndAt": null,
      "vipAutoRenew": "NO",
      "createdOn": "2025-08-21T08:00:00",
      "updatedOn": "2025-08-21T08:00:00",
      "createTime": "2025-08-21T08:00:00",
      "updateTime": "2025-08-21T08:00:00"
    }
  ],
  "timestamp": "2025-08-21T08:30:00"
}
```

#### 测试用例
```bash
# 获取所有域名
curl -X GET "http://localhost:8080/api/domains" \
  -H "Content-Type: application/json"
```

### 3. 根据DNSPod域名ID获取域名接口

#### 基本信息
- **接口标识**: `DOMAIN_GET_BY_ID`
- **请求路径**: `GET /api/domains/dnspod/{domainId}`
- **接口描述**: 根据DNSPod域名ID获取域名信息
- **认证要求**: 无需认证

#### 路径参数
- `domainId`: DNSPod域名ID（Long类型）

#### 响应示例

##### 成功响应（状态码 200）
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "domainId": 123456,
    "name": "example.com",
    "punycode": "example.com",
    "grade": "DP_Free",
    "gradeLevel": 1,
    "gradeTitle": "免费套餐",
    "isVip": "NO",
    "owner": "user@example.com",
    "status": "ENABLE",
    "groupId": 1,
    "searchEnginePush": "NO",
    "recordCount": 5,
    "ttl": 600,
    "cnameSpeedup": "DISABLE",
    "dnsStatus": "DNSPOD",
    "remark": "测试域名",
    "vipStartAt": null,
    "vipEndAt": null,
    "vipAutoRenew": "NO",
    "createdOn": "2025-08-21T08:00:00",
    "updatedOn": "2025-08-21T08:00:00",
    "createTime": "2025-08-21T08:00:00",
    "updateTime": "2025-08-21T08:00:00"
  },
  "timestamp": "2025-08-21T08:30:00"
}
```

##### 域名不存在（状态码 404）
```json
{
  "code": 404,
  "message": "域名不存在",
  "data": null,
  "timestamp": "2025-08-21T08:30:00"
}
```

#### 测试用例
```bash
# 根据DNSPod域名ID获取域名
curl -X GET "http://localhost:8080/api/domains/dnspod/123456" \
  -H "Content-Type: application/json"
```

### 4. 根据域名名称获取域名接口

#### 基本信息
- **接口标识**: `DOMAIN_GET_BY_NAME`
- **请求路径**: `GET /api/domains/name/{name}`
- **接口描述**: 根据域名名称获取域名信息
- **认证要求**: 无需认证

#### 路径参数
- `name`: 域名名称（String类型）

#### 测试用例
```bash
# 根据域名名称获取域名
curl -X GET "http://localhost:8080/api/domains/name/example.com" \
  -H "Content-Type: application/json"
```

### 5. 根据状态获取域名列表接口

#### 基本信息
- **接口标识**: `DOMAIN_GET_BY_STATUS`
- **请求路径**: `GET /api/domains/status/{status}`
- **接口描述**: 根据域名状态获取域名列表
- **认证要求**: 无需认证

#### 路径参数
- `status`: 域名状态（String类型，如：ENABLE、DISABLE、PAUSE等）

#### 测试用例
```bash
# 根据状态获取域名列表
curl -X GET "http://localhost:8080/api/domains/status/ENABLE" \
  -H "Content-Type: application/json"
```

### 6. 根据分组ID获取域名列表接口

#### 基本信息
- **接口标识**: `DOMAIN_GET_BY_GROUP`
- **请求路径**: `GET /api/domains/group/{groupId}`
- **接口描述**: 根据分组ID获取域名列表
- **认证要求**: 无需认证

#### 路径参数
- `groupId`: 分组ID（Integer类型）

#### 测试用例
```bash
# 根据分组ID获取域名列表
curl -X GET "http://localhost:8080/api/domains/group/1" \
  -H "Content-Type: application/json"
```

### 7. 搜索域名接口

#### 基本信息
- **接口标识**: `DOMAIN_SEARCH`
- **请求路径**: `GET /api/domains/search`
- **接口描述**: 根据关键字搜索域名（模糊匹配域名名称）
- **认证要求**: 无需认证

#### 查询参数
- `keyword`: 搜索关键字（String类型，必填）

#### 测试用例
```bash
# 搜索域名
curl -X GET "http://localhost:8080/api/domains/search?keyword=example" \
  -H "Content-Type: application/json"
```

### 8. 分页获取域名列表接口

#### 基本信息
- **接口标识**: `DOMAIN_PAGE`
- **请求路径**: `GET /api/domains/page`
- **接口描述**: 分页获取域名列表
- **认证要求**: 无需认证

#### 查询参数
- `offset`: 偏移量（Integer类型，可选，默认0）
- `limit`: 限制数量（Integer类型，可选，默认20）

#### 测试用例
```bash
# 分页获取域名列表
curl -X GET "http://localhost:8080/api/domains/page?offset=0&limit=10" \
  -H "Content-Type: application/json"
```

### 9. 统计域名总数接口

#### 基本信息
- **接口标识**: `DOMAIN_COUNT`
- **请求路径**: `GET /api/domains/count`
- **接口描述**: 统计域名总数
- **认证要求**: 无需认证

#### 响应示例
```json
{
  "code": 200,
  "message": "操作成功",
  "data": 15,
  "timestamp": "2025-08-21T08:30:00"
}
```

#### 测试用例
```bash
# 统计域名总数
curl -X GET "http://localhost:8080/api/domains/count" \
  -H "Content-Type: application/json"
```

### 10. 根据状态统计域名数量接口

#### 基本信息
- **接口标识**: `DOMAIN_COUNT_BY_STATUS`
- **请求路径**: `GET /api/domains/count/status/{status}`
- **接口描述**: 根据状态统计域名数量
- **认证要求**: 无需认证

#### 路径参数
- `status`: 域名状态（String类型）

#### 测试用例
```bash
# 根据状态统计域名数量
curl -X GET "http://localhost:8080/api/domains/count/status/ENABLE" \
  -H "Content-Type: application/json"
```

### 11. 保存域名信息接口

#### 基本信息
- **接口标识**: `DOMAIN_SAVE`
- **请求路径**: `POST /api/domains`
- **接口描述**: 保存域名信息到数据库
- **认证要求**: 无需认证

#### 请求参数
```json
{
  "domainId": 123456,
  "name": "example.com",
  "punycode": "example.com",
  "grade": "DP_Free",
  "gradeLevel": 1,
  "gradeTitle": "免费套餐",
  "isVip": "NO",
  "owner": "user@example.com",
  "status": "ENABLE",
  "groupId": 1,
  "searchEnginePush": "NO",
  "recordCount": 5,
  "ttl": 600,
  "cnameSpeedup": "DISABLE",
  "dnsStatus": "DNSPOD",
  "remark": "测试域名",
  "vipStartAt": null,
  "vipEndAt": null,
  "vipAutoRenew": "NO",
  "createdOn": "2025-08-21T08:00:00",
  "updatedOn": "2025-08-21T08:00:00"
}
```

#### 测试用例
```bash
# 保存域名信息
curl -X POST "http://localhost:8080/api/domains" \
  -H "Content-Type: application/json" \
  -d '{
    "domainId": 123456,
    "name": "test.com",
    "punycode": "test.com",
    "grade": "DP_Free",
    "gradeLevel": 1,
    "gradeTitle": "免费套餐",
    "isVip": "NO",
    "owner": "test@example.com",
    "status": "ENABLE",
    "groupId": 1,
    "searchEnginePush": "NO",
    "recordCount": 0,
    "ttl": 600,
    "cnameSpeedup": "DISABLE",
    "dnsStatus": "DNSPOD",
    "remark": "测试域名",
    "vipStartAt": null,
    "vipEndAt": null,
    "vipAutoRenew": "NO",
    "createdOn": "2025-08-21T08:00:00",
    "updatedOn": "2025-08-21T08:00:00"
  }'
```

### 12. 更新域名信息接口

#### 基本信息
- **接口标识**: `DOMAIN_UPDATE`
- **请求路径**: `POST /api/domains/update`
- **接口描述**: 更新域名信息
- **认证要求**: 无需认证

#### 请求参数
与保存域名信息接口相同，需要包含完整的域名信息。

#### 测试用例
```bash
# 更新域名信息
curl -X POST "http://localhost:8080/api/domains/update" \
  -H "Content-Type: application/json" \
  -d '{
    "id": 1,
    "domainId": 123456,
    "name": "test.com",
    "punycode": "test.com",
    "grade": "DP_Free",
    "gradeLevel": 1,
    "gradeTitle": "免费套餐",
    "isVip": "NO",
    "owner": "test@example.com",
    "status": "ENABLE",
    "groupId": 1,
    "searchEnginePush": "NO",
    "recordCount": 10,
    "ttl": 300,
    "cnameSpeedup": "DISABLE",
    "dnsStatus": "DNSPOD",
    "remark": "更新后的测试域名",
    "vipStartAt": null,
    "vipEndAt": null,
    "vipAutoRenew": "NO",
    "createdOn": "2025-08-21T08:00:00",
    "updatedOn": "2025-08-21T08:30:00"
  }'
```

### 13. 删除域名信息接口

#### 基本信息
- **接口标识**: `DOMAIN_DELETE`
- **请求路径**: `POST /api/domains/delete/{domainId}`
- **接口描述**: 根据DNSPod域名ID删除域名信息
- **认证要求**: 无需认证

#### 路径参数
- `domainId`: DNSPod域名ID（Long类型）

#### 响应示例

##### 成功响应（状态码 200）
```json
{
  "code": 200,
  "message": "操作成功",
  "data": true,
  "timestamp": "2025-08-21T08:30:00"
}
```

##### 域名不存在（状态码 404）
```json
{
  "code": 404,
  "message": "域名不存在或删除失败",
  "data": null,
  "timestamp": "2025-08-21T08:30:00"
}
```

#### 测试用例
```bash
# 删除域名信息
curl -X POST "http://localhost:8080/api/domains/delete/123456" \
  -H "Content-Type: application/json"
```

## 数据模型

### Domain实体类字段说明

| 字段名 | 类型 | 说明 | 示例值 |
|--------|------|------|--------|
| id | Long | 主键ID | 1 |
| domainId | Long | DNSPod域名ID | 123456 |
| name | String | 域名名称 | "example.com" |
| punycode | String | 域名Punycode编码 | "example.com" |
| grade | String | 域名套餐等级 | "DP_Free" |
| gradeLevel | Integer | 套餐等级数值 | 1 |
| gradeTitle | String | 套餐等级标题 | "免费套餐" |
| isVip | String | 是否为VIP域名 | "NO" |
| owner | String | 域名所有者 | "user@example.com" |
| status | String | 域名状态 | "ENABLE" |
| groupId | Integer | 分组ID | 1 |
| searchEnginePush | String | 搜索引擎推送状态 | "NO" |
| recordCount | Integer | 解析记录数量 | 5 |
| ttl | Integer | 默认TTL值 | 600 |
| cnameSpeedup | String | CNAME加速状态 | "DISABLE" |
| dnsStatus | String | DNS状态 | "DNSPOD" |
| remark | String | 域名备注 | "测试域名" |
| vipStartAt | LocalDateTime | VIP开始时间 | null |
| vipEndAt | LocalDateTime | VIP结束时间 | null |
| vipAutoRenew | String | VIP自动续费状态 | "NO" |
| createdOn | LocalDateTime | DNSPod创建时间 | "2025-08-21T08:00:00" |
| updatedOn | LocalDateTime | DNSPod更新时间 | "2025-08-21T08:00:00" |
| createTime | LocalDateTime | 本地创建时间 | "2025-08-21T08:00:00" |
| updateTime | LocalDateTime | 本地更新时间 | "2025-08-21T08:00:00" |

## 错误码说明

| 状态码 | 含义 | 适用场景 |
|--------|------|----------|
| 200 | 成功 | 请求处理完成且结果正常 |
| 404 | 资源不存在 | 域名不存在 |
| 500 | 服务器错误 | 数据库操作失败、DNSPod API调用失败等 |

## 注意事项

1. **数据同步**：域名同步功能会从DNSPod获取最新的域名列表，并更新本地数据库
2. **数据一致性**：同步过程中会使用`INSERT ... ON DUPLICATE KEY UPDATE`语句确保数据一致性
3. **错误处理**：所有接口都包含完善的异常处理机制
4. **性能考虑**：分页查询接口支持大量域名数据的高效查询
5. **搜索功能**：支持域名名称的模糊搜索，便于快速定位域名

## 测试脚本

创建完整的测试脚本来验证所有接口功能：

```bash
#!/bin/bash

BASE_URL="http://localhost:8080/api/domains"

echo "=== 域名同步功能接口测试 ==="

# 1. 测试域名同步
echo "1. 测试域名同步..."
curl -X POST "$BASE_URL/sync" -H "Content-Type: application/json"
echo -e "\n"

# 2. 获取所有域名
echo "2. 获取所有域名..."
curl -X GET "$BASE_URL" -H "Content-Type: application/json"
echo -e "\n"

# 3. 统计域名总数
echo "3. 统计域名总数..."
curl -X GET "$BASE_URL/count" -H "Content-Type: application/json"
echo -e "\n"

# 4. 分页获取域名列表
echo "4. 分页获取域名列表..."
curl -X GET "$BASE_URL/page?offset=0&limit=5" -H "Content-Type: application/json"
echo -e "\n"

# 5. 搜索域名
echo "5. 搜索域名..."
curl -X GET "$BASE_URL/search?keyword=cblog" -H "Content-Type: application/json"
echo -e "\n"

# 6. 根据状态获取域名列表
echo "6. 根据状态获取域名列表..."
curl -X GET "$BASE_URL/status/ENABLE" -H "Content-Type: application/json"
echo -e "\n"

# 7. 根据状态统计域名数量
echo "7. 根据状态统计域名数量..."
curl -X GET "$BASE_URL/count/status/ENABLE" -H "Content-Type: application/json"
echo -e "\n"

echo "=== 测试完成 ==="
```

保存为 `test_domain_sync.sh` 并执行：
```bash
chmod +x test_domain_sync.sh
./test_domain_sync.sh