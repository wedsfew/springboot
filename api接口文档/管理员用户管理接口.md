# 管理员用户管理API接口文档

## 一、接口概述

本文档描述了管理员对用户进行增删改查的API接口，这些接口只能由具有ADMIN或SUPER_ADMIN角色的用户访问。

### 基本信息

| 项目             | 内容                           |
| ---------------- | ------------------------------ |
| **Base URL**     | `http://localhost:8080/api/admin/users` |
| **Content-Type** | `application/json`             |
| **字符编码**     | `UTF-8`                        |
| **认证要求**     | 需要管理员JWT令牌              |

## 二、接口详情

### 2.1 获取所有用户

#### 基本信息

- **接口标识**：`ADMIN_GET_ALL_USERS`
- **请求路径**：`GET /api/admin/users/`
- **接口描述**：管理员获取系统中所有用户的列表
- **认证要求**：需要管理员权限（ADMIN或SUPER_ADMIN角色）

#### 请求头

```
Authorization: Bearer {管理员JWT令牌}
```

#### 响应示例

##### 成功响应（状态码 200）

```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "id": 1,
      "username": "user1",
      "password": null,
      "email": "user1@example.com",
      "role": "USER",
      "createTime": "2025-08-11T09:30:40",
      "updateTime": "2025-08-11T09:30:40"
    },
    {
      "id": 2,
      "username": "user2",
      "password": null,
      "email": "user2@example.com",
      "role": "USER",
      "createTime": "2025-08-11T09:30:40",
      "updateTime": "2025-08-11T09:31:04"
    }
  ],
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

##### 未授权响应（状态码 401）

```json
{
  "code": 401,
  "message": "未授权：Full authentication is required to access this resource",
  "data": null,
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

### 2.2 根据ID获取用户

#### 基本信息

- **接口标识**：`ADMIN_GET_USER_BY_ID`
- **请求路径**：`GET /api/admin/users/{id}`
- **接口描述**：管理员根据用户ID获取用户详细信息
- **认证要求**：需要管理员权限（ADMIN或SUPER_ADMIN角色）

#### 请求头

```
Authorization: Bearer {管理员JWT令牌}
```

#### 路径参数

| 参数名 | 类型   | 描述     | 是否必须 |
| ------ | ------ | -------- | -------- |
| id     | Long   | 用户ID   | 是       |

#### 响应示例

##### 成功响应（状态码 200）

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "username": "user1",
    "password": null,
    "email": "user1@example.com",
    "role": "USER",
    "createTime": "2025-08-11T09:30:40",
    "updateTime": "2025-08-11T09:30:40"
  },
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

##### 用户不存在响应（状态码 404）

```json
{
  "code": 404,
  "message": "用户不存在",
  "data": null,
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

### 2.3 创建用户

#### 基本信息

- **接口标识**：`ADMIN_CREATE_USER`
- **请求路径**：`POST /api/admin/users`
- **接口描述**：管理员创建新用户
- **认证要求**：需要管理员权限（ADMIN或SUPER_ADMIN角色）

#### 请求头

```
Authorization: Bearer {管理员JWT令牌}
Content-Type: application/json
```

#### 请求参数

```json
{
  "username": "newuser",
  "password": "Password123",
  "email": "newuser@example.com",
  "role": "USER"
}
```

#### 参数说明

| 参数名   | 类型   | 必填 | 说明                                     |
| -------- | ------ | ---- | ---------------------------------------- |
| username | string | 是   | 用户名                                   |
| password | string | 是   | 密码                                     |
| email    | string | 是   | 用户邮箱，需符合标准格式（如xxx@xx.com） |
| role     | string | 否   | 用户角色，默认为"USER"                   |

#### 响应示例

##### 成功响应（状态码 201）

```json
{
  "code": 201,
  "message": "创建成功",
  "data": {
    "id": 3,
    "username": "newuser",
    "password": null,
    "email": "newuser@example.com",
    "role": "USER",
    "createTime": "2025-08-11T10:30:00",
    "updateTime": "2025-08-11T10:30:00"
  },
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

##### 邮箱已存在响应（状态码 409）

```json
{
  "code": 409,
  "message": "该邮箱已被注册",
  "data": null,
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

##### 参数验证失败响应（状态码 400）

```json
{
  "code": 400,
  "message": "用户名不能为空",
  "data": null,
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

### 2.4 更新用户

#### 基本信息

- **接口标识**：`ADMIN_UPDATE_USER`
- **请求路径**：`PUT /api/admin/users/{id}`
- **接口描述**：管理员更新指定ID的用户信息
- **认证要求**：需要管理员权限（ADMIN或SUPER_ADMIN角色）

#### 请求头

```
Authorization: Bearer {管理员JWT令牌}
Content-Type: application/json
```

#### 路径参数

| 参数名 | 类型   | 描述     | 是否必须 |
| ------ | ------ | -------- | -------- |
| id     | Long   | 用户ID   | 是       |

#### 请求参数

```json
{
  "username": "updateduser",
  "password": "NewPassword123",
  "email": "updated@example.com",
  "role": "USER"
}
```

#### 参数说明

| 参数名   | 类型   | 必填 | 说明                                     |
| -------- | ------ | ---- | ---------------------------------------- |
| username | string | 否   | 用户名，不提供则保持原值                 |
| password | string | 否   | 密码，不提供则保持原值                   |
| email    | string | 否   | 用户邮箱，不提供则保持原值               |
| role     | string | 否   | 用户角色，不提供则保持原值               |

#### 响应示例

##### 成功响应（状态码 200）

```json
{
  "code": 200,
  "message": "用户更新成功",
  "data": {
    "id": 1,
    "username": "updateduser",
    "password": null,
    "email": "updated@example.com",
    "role": "USER",
    "createTime": "2025-08-11T09:30:40",
    "updateTime": "2025-08-11T10:30:00"
  },
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

##### 用户不存在响应（状态码 404）

```json
{
  "code": 404,
  "message": "用户不存在",
  "data": null,
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

##### 邮箱已存在响应（状态码 500）

```json
{
  "code": 500,
  "message": "更新用户失败: Duplicate entry 'updated@example.com' for key 'user.email'",
  "data": null,
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

### 2.5 删除用户

#### 基本信息

- **接口标识**：`ADMIN_DELETE_USER`
- **请求路径**：`DELETE /api/admin/users/{id}`
- **接口描述**：管理员删除指定ID的用户
- **认证要求**：需要管理员权限（ADMIN或SUPER_ADMIN角色）

#### 请求头

```
Authorization: Bearer {管理员JWT令牌}
```

#### 路径参数

| 参数名 | 类型   | 描述     | 是否必须 |
| ------ | ------ | -------- | -------- |
| id     | Long   | 用户ID   | 是       |

#### 响应示例

##### 成功响应（状态码 200）

```json
{
  "code": 200,
  "message": "用户删除成功",
  "data": null,
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

##### 用户不存在响应（状态码 404）

```json
{
  "code": 404,
  "message": "用户不存在",
  "data": null,
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

### 2.6 根据邮箱查询用户

#### 基本信息

- **接口标识**：`ADMIN_GET_USER_BY_EMAIL`
- **请求路径**：`GET /api/admin/users/email/{email}`
- **接口描述**：管理员根据邮箱地址查询用户
- **认证要求**：需要管理员权限（ADMIN或SUPER_ADMIN角色）

#### 请求头

```
Authorization: Bearer {管理员JWT令牌}
```

#### 路径参数

| 参数名 | 类型   | 描述     | 是否必须 |
| ------ | ------ | -------- | -------- |
| email  | String | 邮箱地址 | 是       |

#### 响应示例

##### 成功响应（状态码 200）

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "username": "user1",
    "password": null,
    "email": "user1@example.com",
    "role": "USER",
    "createTime": "2025-08-11T09:30:40",
    "updateTime": "2025-08-11T09:30:40"
  },
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

##### 用户不存在响应（状态码 404）

```json
{
  "code": 404,
  "message": "用户不存在",
  "data": null,
  "timestamp": "2025-08-11T10:30:00+08:00"
}
```

## 三、测试用例

### 3.1 获取所有用户测试

```bash
curl -X GET http://localhost:8080/api/admin/users/ \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiQURNSU4iLCJzdWIiOiI3IiwiaWF0IjoxNzU0ODgxNzIxLCJleHAiOjE3NTQ5NjgxMjF9.twfzQl6jyyBqRPlZPwZuf73Lgy9Al_udWWxXZOgUnAc"
```

### 3.2 根据ID获取用户测试

```bash
curl -X GET http://localhost:8080/api/admin/users/4 \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiQURNSU4iLCJzdWIiOiI3IiwiaWF0IjoxNzU0ODgxNzIxLCJleHAiOjE3NTQ5NjgxMjF9.twfzQl6jyyBqRPlZPwZuf73Lgy9Al_udWWxXZOgUnAc"
```

### 3.3 创建用户测试

```bash
curl -X POST http://localhost:8080/api/admin/users \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiQURNSU4iLCJzdWIiOiI3IiwiaWF0IjoxNzU0ODgxNzIxLCJleHAiOjE3NTQ5NjgxMjF9.twfzQl6jyyBqRPlZPwZuf73Lgy9Al_udWWxXZOgUnAc" \
  -d '{"username":"secureUser","password":"SecurePass123","email":"secure@example.com","role":"USER"}'
```

### 3.4 更新用户测试

```bash
curl -X PUT http://localhost:8080/api/admin/users/8 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiQURNSU4iLCJzdWIiOiI3IiwiaWF0IjoxNzU0ODgxNzIxLCJleHAiOjE3NTQ5NjgxMjF9.twfzQl6jyyBqRPlZPwZuf73Lgy9Al_udWWxXZOgUnAc" \
  -d '{"username":"updatedSecureUser","password":"NewSecurePass456","email":"unique_updated@example.com","role":"USER"}'
```

### 3.5 删除用户测试

```bash
curl -X DELETE http://localhost:8080/api/admin/users/8 \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiQURNSU4iLCJzdWIiOiI3IiwiaWF0IjoxNzU0ODgxNzIxLCJleHAiOjE3NTQ5NjgxMjF9.twfzQl6jyyBqRPlZPwZuf73Lgy9Al_udWWxXZOgUnAc"
```

### 3.6 根据邮箱查询用户测试

```bash
curl -X GET http://localhost:8080/api/admin/users/email/unique_updated@example.com \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiQURNSU4iLCJzdWIiOiI3IiwiaWF0IjoxNzU0ODgxNzIxLCJleHAiOjE3NTQ5NjgxMjF9.twfzQl6jyyBqRPlZPwZuf73Lgy9Al_udWWxXZOgUnAc"
```

## 四、注意事项

1. 所有接口都需要管理员JWT令牌进行认证
2. 管理员必须具有ADMIN或SUPER_ADMIN角色才能访问这些接口
3. 创建和更新用户时，密码会自动进行加密存储
4. 返回的用户信息中，密码字段会被设置为null，保护用户隐私
5. 删除用户操作不可逆，请谨慎操作
6. 邮箱地址必须唯一，更新用户时如果提供的邮箱已被其他用户使用，将返回错误