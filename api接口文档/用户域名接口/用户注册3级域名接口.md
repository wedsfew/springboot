# 用户注册3级域名接口文档

## 接口概述
用于用户注册新的3级域名。接口会先检查域名是否已被注册，如果未注册则创建新的域名记录。

## 接口详情

### 用户注册3级域名

**接口地址：** `POST /api/user/subdomain/register`

**请求方式：** POST

**Content-Type：** `application/json`

**认证方式：** Bearer Token（JWT）

**请求头：**
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Authorization | String | 是 | Bearer {token} |
| Content-Type | String | 是 | application/json |

**请求参数：**
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| subdomain | String | 是 | 子域名前缀，如：www |
| domain | String | 是 | 主域名，如：cblog.eu |

**请求体格式：**
```json
{
  "subdomain": "www",
  "domain": "cblog.eu"
}
```

**请求示例：**
```bash
curl -X POST "http://localhost:8080/api/user/subdomain/register" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9..." \
  -d '{
    "subdomain": "www",
    "domain": "cblog.eu"
  }'
```

## 响应格式

### 成功响应
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "userId": 123,
    "subdomain": "www",
    "domain": "cblog.eu",
    "fullDomain": "www.cblog.eu",
    "status": "ACTIVE",
    "remark": "user@example.com",
    "createTime": "2025-08-24T03:00:00",
    "updateTime": "2025-08-24T03:00:00"
  },
  "timestamp": "2025-08-24T03:00:00"
}
```

### 域名已注册响应
```json
{
  "code": 400,
  "message": "域名 www.cblog.eu 已注册",
  "data": null,
  "timestamp": "2025-08-24T03:00:00"
}
```

### 认证失败响应
```json
{
  "code": 401,
  "message": "未授权访问",
  "data": null,
  "timestamp": "2025-08-24T03:00:00"
}
```

### 系统错误响应
```json
{
  "code": 500,
  "message": "注册域名失败：数据库连接异常",
  "data": null,
  "timestamp": "2025-08-24T03:00:00"
}
```

## 业务流程

### 注册流程
1. **身份验证**：验证JWT token的有效性
2. **提取用户信息**：从token中获取用户ID和邮箱
3. **域名可用性检查**：调用域名注册查询接口检查域名是否已注册
4. **创建域名记录**：如果域名未注册，则在user_subdomain表中创建新记录
5. **返回结果**：返回创建的域名信息

### 数据处理
- **用户ID**：从JWT token的subject中获取
- **邮箱**：从JWT token的email声明中获取，作为remark字段存储
- **完整域名**：由subdomain + "." + domain组成
- **状态**：默认设置为"ACTIVE"

## 字段说明

### 响应数据字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | Long | 域名记录主键ID |
| userId | Long | 用户ID（从token获取） |
| subdomain | String | 子域名前缀 |
| domain | String | 主域名 |
| fullDomain | String | 完整域名 |
| status | String | 状态（ACTIVE-活跃） |
| remark | String | 备注信息（用户邮箱） |
| createTime | LocalDateTime | 创建时间 |
| updateTime | LocalDateTime | 更新时间 |

## 错误处理

### 参数验证错误
- 子域名或主域名为空
- JWT token无效或过期
- Authorization头缺失

### 业务逻辑错误
- 域名已被注册
- 用户权限不足
- 数据库操作失败

## 安全考虑

1. **JWT认证**：必须提供有效的JWT token
2. **用户隔离**：只能为当前登录用户注册域名
3. **域名唯一性**：确保域名在全局范围内唯一
4. **输入验证**：验证域名格式的合法性

## 使用场景

1. **用户首次注册域名**：为新用户分配3级域名
2. **域名扩展**：用户注册额外的子域名
3. **域名管理**：配合其他接口实现完整的域名管理功能

## 相关接口

- [查询域名是否已注册接口](./用户域名注册查询接口.md)
- [查询用户域名列表接口](./用户子域名管理接口.md#查询域名列表)
- [域名状态管理接口](./用户子域名管理接口.md#状态管理)
- [用户登录接口](./用户登录接口.md)

## 注意事项

1. 接口需要JWT认证，请确保token有效
2. remark字段自动填充为用户邮箱
3. 域名注册成功后状态默认为ACTIVE
4. 完整域名在全局范围内必须唯一
5. 建议在注册前先调用查询接口检查可用性